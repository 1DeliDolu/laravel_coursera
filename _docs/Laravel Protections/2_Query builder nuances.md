# ğŸ” Query builder incelikleri

Bu videoda, DB Facade ve Eloquent tarafÄ±ndan kullanÄ±lan query builderâ€™Ä±n inceliklerini anlamanÄ±n neden Ã¶nemli olduÄŸunu konuÅŸacaÄŸÄ±z. AyrÄ±ca sorgularÄ±mÄ±zÄ± gÃ¶zden geÃ§irmemize yardÄ±mcÄ± olan hÄ±zlÄ± debugging yÃ¶ntemlerinden de bahsedeceÄŸim. Basit sorgularla baÅŸlayÄ±p giderek daha karmaÅŸÄ±k hÃ¢le getireceÄŸim. Bunu, query builderâ€™Ä±n basit gÃ¶rÃ¼nÃ¼p sonradan kontrolden Ã§Ä±kabileceÄŸini gÃ¶stermek iÃ§in yapÄ±yorum.

Bu Ã¶rnekte where metodunu kullanÄ±yorum; bu, basit bir where ifadesi oluÅŸturan SQL Ã¼retir. BunlarÄ± zincirlediÄŸinizde, select ifadesindeki and kullanÄ±mÄ±nÄ±n karÅŸÄ±lÄ±ÄŸÄ±dÄ±r. EÄŸer where ifadesiyle birlikte or kullanmak istiyorsanÄ±z, bunun yerine orWhere metodunu zincirlemeniz gerekir. OldukÃ§a basit, ancak daha karmaÅŸÄ±k bir sorguya doÄŸru ilerliyoruz.

And ve or ifadelerinin birleÅŸimini kullandÄ±ÄŸÄ±mÄ±zda, closureâ€™lar ile nested where zinciri kurmamÄ±z gerekir. Burada aktif deÄŸeri true olan ve tipi 1 veya 3 olan tÃ¼m ÅŸirketleri bulmak istiyorum. Bir and where yazÄ±yorum fakat nested bir sorgu ile. Bu artÄ±k yeterince karmaÅŸÄ±klaÅŸtÄ±ÄŸÄ±ndan, Ã¼retilen SQLâ€™in neye benzediÄŸini gÃ¶rmek istiyorum. UnutmayÄ±n, or Eloquent sorgusu gibi gÃ¶rÃ¼nse de, alttaki SQLâ€™i anlamak hÃ¢lÃ¢ benim sorumluluÄŸum. BÃ¶ylece beklediÄŸim sorgunun gerÃ§ekten Ã¼retilip Ã¼retilmediÄŸini bilebilirim. Ã–rneÄŸin, gÃ¼venlik izinleri iÃ§in yanlÄ±ÅŸ kolonun sorgulandÄ±ÄŸÄ± bir durum dÃ¼ÅŸÃ¼nÃ¼n; bu Ã§ok kÃ¶tÃ¼ olurdu. AyrÄ±ca veritabanÄ± ÅŸemasÄ± hakkÄ±ndaki bilgime gÃ¶re verimsiz bir sorgu oluÅŸturulup oluÅŸturulmadÄ±ÄŸÄ±nÄ± kontrol edebilirim.

Bu ÅŸekilde oluÅŸturulmuÅŸ bir sorguyu debug etmek iÃ§in en basit yÃ¶ntem, veriyi almak yerine toSql metodunu Ã§aÄŸÄ±rmaktÄ±r. Bu, oluÅŸturulan sorgunun string hÃ¢lini verir. Bu Ã¶rnekte nested closureâ€™Ä±n where ifadelerini parantez iÃ§ine aldÄ±ÄŸÄ±nÄ± gÃ¶rebilirsiniz; beklediÄŸim ve umduÄŸum ÅŸey tam olarak buydu.

UygulamanÄ±zÄ±n app service providerâ€™Ä±nda aÅŸaÄŸÄ±daki gibi bir database listener kaydedebilirsiniz. Basit bir Ã¶rnekte, Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±m her sorgunun string karÅŸÄ±lÄ±ÄŸÄ±nÄ± log dosyama gÃ¶ndereceÄŸim; bÃ¶ylece scriptâ€™i durdurmadan veya Ã§Ä±ktÄ±yÄ± bozmadan inceleyebilirim. Ya da daha iyisi, Laravel ekibi tarafÄ±ndan geliÅŸtirilen ve Ã¶nerilen Laravel Telescopeâ€™u kullanabilirsiniz. Bu araÃ§, jobâ€™lar, session bilgisi, request parametreleri ve sorgular gibi pek Ã§ok ÅŸeyi izleyerek uygulamanÄ±z hakkÄ±nda ciddi iÃ§gÃ¶rÃ¼ saÄŸlar.

VarsayÄ±lan olarak her ortamda kurulu gelmez; composer ile `--dev` parametresi ile kurmanÄ±z gerekir. Sonra app service providerâ€™Ä±n register metodunda bu Ã¶rnekteki gibi kaydedebilirsiniz, bÃ¶ylece sadece local ortamda Ã§alÄ±ÅŸÄ±r. Telescopeâ€™a dÃ¶nersek, requestâ€™i gÃ¶recek ve iÃ§eriÄŸini incelemek iÃ§in Ã¼zerine tÄ±klayabileceksiniz. Ekranda request bilgilerini gÃ¶rebilir, daha sonra aÅŸaÄŸÄ±daki sekmelere ilerleyebilirsiniz. Bu Ã¶rnekte DB listenerâ€™dan gelen bir log gÃ¶rebilirsiniz. Ancak Telescope kullanÄ±yorsanÄ±z muhtemelen bÃ¶yle ÅŸeyleri loglamÄ±yorsunuzdur. Queries sekmesine tÄ±klayÄ±n; burada karmaÅŸÄ±k builderâ€™dan Ã¼retilmiÅŸ sorguyu gÃ¶receksiniz. Bound parametreleri de yerleÅŸtirerek okunmasÄ±nÄ± kolaylaÅŸtÄ±rÄ±r.

Peki gerÃ§ekten karmaÅŸÄ±k bir ÅŸey, Ã¶rneÄŸin unionâ€™lar yaparsanÄ±z ne olur? Burada iki ayrÄ± ama aynÄ± derecede karmaÅŸÄ±k sorguyu union ile birleÅŸtiren bir Ã¶rnek var; saÄŸda Ã¼retilen Ã§Ä±ktÄ±yÄ± gÃ¶rebilirsiniz. Bu Ã§Ä±ktÄ±nÄ±n doÄŸru olmasÄ± tesadÃ¼f deÄŸil, bÃ¶yle Ã§alÄ±ÅŸacak ÅŸekilde tasarlanmÄ±ÅŸtÄ±r. Ancak ne kadar karmaÅŸÄ±k olabileceÄŸini gÃ¶rebilirsiniz. Ya iki unionâ€™Ä±n unionâ€™lanmasÄ± gerekirse? Bir seviyeyi doÄŸru parantezle yapabildi ama Ã§oklu seviyelerde ne olacak? Query builder doÄŸru parantezleri kullanmayÄ± bilecek mi? Burada hata payÄ± Ã§ok yÃ¼ksek, bu yÃ¼zden Ã¼retilen sorgunun tam olarak beklediÄŸiniz ÅŸey olduÄŸundan emin olmalÄ±sÄ±nÄ±z. Bu sadece bir gÃ¼venlik konusu deÄŸil; veri doÄŸruluÄŸu konusu da.

Ä°ÅŸte beklenmedik davranÄ±ÅŸa Ã§ok basit bir Ã¶rnek. Bu durumda programcÄ± son or ifadesinin ne yapacaÄŸÄ±nÄ± dÃ¼ÅŸÃ¼ndÃ¼ bilmiyorum, fakat saÄŸdaki Ã§Ä±ktÄ±da son orâ€™un parantezlerin dÄ±ÅŸÄ±nda kaldÄ±ÄŸÄ±nÄ± gÃ¶rebilirsiniz; yani iÅŸlem sÄ±rasÄ± beklenenden farklÄ± olabilir.

Demek istediÄŸim ÅŸu: Query builder ile spesifik kaynaklara eriÅŸimi sÄ±nÄ±rlamak iÃ§in sorgular yazmanÄ±z gerekebilir. Kurulumunuza baÄŸlÄ± olarak hesaplamalar oldukÃ§a karmaÅŸÄ±k olabilir. Query builderâ€™a gÃ¼venebilirsiniz, fakat SQL ifadelerini yine de doÄŸrulamalÄ±sÄ±nÄ±z. Ã‡Ã¼nkÃ¼ PHP (ve Laravel) ile SQLâ€™e yapÄ±lan Ã§eviri her zaman birebir deÄŸildir.
