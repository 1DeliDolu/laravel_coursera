# ğŸ” Secretsâ€™leri GÃ¼venceye Alma ve KonfigÃ¼rasyon KullanÄ±mÄ±

Bu kurs, secretsâ€™leri korumak ve bilgi sÄ±zÄ±ntÄ±sÄ±nÄ± azaltmakla ilgilidir. Bu videoda konfigÃ¼rasyondan ve bu secretsâ€™leri gÃ¼venceye almak iÃ§in kullanÄ±lan en iyi yÃ¶ntemlerden bahsedeceÄŸiz. Ä°lk olarak konfigÃ¼rasyonlarÄ±mÄ±zÄ± environment variableâ€™lara koymak istiyoruz. BunlarÄ± sunucuya veya o an Ã§alÄ±ÅŸan kullanÄ±cÄ±nÄ±n profilindeki ortama koyabiliriz. PHP yapÄ±landÄ±rmanÄ±za baÄŸlÄ± olarak bunlara env veya server global deÄŸiÅŸkenleriyle eriÅŸebilirsiniz. AyrÄ±ca .env adÄ±nda bir paket vardÄ±r ve bu yÃ¶ntem birÃ§ok programlama dilinde bulunur. PHP iÃ§in .env adÄ±nda bir sÃ¼rÃ¼mÃ¼ vardÄ±r ve env dosyasÄ±nÄ± okuyup deÄŸiÅŸkenleri ortamda kullanÄ±labilir hÃ¢le getirir.

Bu elbette Laravel tarafÄ±ndan Ã¶nerilen yÃ¶ntemdir ve Laravel proje kurulumuyla beraber gelir. Bu env dosyasÄ±nÄ± asla commit etmek istemeyiz. Secretsâ€™lerimizi ve her ortama Ã¶zgÃ¼ yapÄ±landÄ±rmalarÄ± buna koyacaÄŸÄ±z. BunlarÄ± git deposuna koyup herkesle paylaÅŸmak istemeyiz. Ancak bir .env example dosyasÄ± oluÅŸturabilirsiniz; bu dosya varsayÄ±lan yapÄ±landÄ±rmalarÄ±n Ã§oÄŸunu iÃ§erir. Bu yapÄ±landÄ±rmalar her geliÅŸtirici veya her makine iÃ§in Ã¶zelleÅŸtirilebilir ya da CI/CD pipeline veya production kurulumu iÃ§in kopyalanÄ±p dÃ¼zenlenebilir. Laravel create project komutu varsayÄ±lan olarak bir gitignore dosyasÄ± oluÅŸturur ve ÅŸÃ¶yle gÃ¶rÃ¼nÃ¼r. Burada env dosyasÄ±nÄ±n zaten ignore edildiÄŸini gÃ¶rÃ¼rsÃ¼nÃ¼z, bÃ¶ylece yanlÄ±ÅŸlÄ±kla commit etmezsiniz.

Peki bir projeyi devralÄ±yorsanÄ±z veya bu legacy bir uygulamaysa ya da birisi yanlÄ±ÅŸlÄ±kla env dosyasÄ±nÄ± commit ettiyse? Bunun iÃ§in BFG Repo Cleaner adÄ±nda bir araÃ§ vardÄ±r. Bu, historyâ€™den bu dosyayÄ± silip temizleyebilir. Git geÃ§miÅŸinizi yeniden yazacaÄŸÄ± iÃ§in biraz sert bir yÃ¶ntemdir, ancak bunu ertelemektense erken yapmak daha iyidir ve secretsâ€™leri koddaki geÃ§miÅŸten Ã§Ä±karmÄ±ÅŸ olursunuz. EÄŸer bunu yaptÄ±ysanÄ±z ve kodu bir yere pushladÄ±ysanÄ±z, secretsâ€™leri rotate etmek iyi bir fikirdir, Ã§Ã¼nkÃ¼ GitHubâ€™a dÃ¼ÅŸtÃ¼yse artÄ±k oradadÄ±r.

Åimdi bunun nasÄ±l Ã§alÄ±ÅŸabileceÄŸine dair bir Ã¶rneÄŸe bakalÄ±m. Åu anda env dosyasÄ±nÄ±n git geÃ§miÅŸinde bulunduÄŸu bir repodayÄ±m. Ä°lk commitâ€™te bunun dahil edildiÄŸini gÃ¶rebiliyorum ve sÃ¼reÃ§ boyunca birkaÃ§ kez deÄŸiÅŸtirilmiÅŸ gibi duruyor. Buradan Ã§Ä±kalÄ±m. BFG komutunu delete files bayraÄŸÄ±yla env dosyasÄ±nÄ± hedef alacak ÅŸekilde Ã§alÄ±ÅŸtÄ±rÄ±yoruz ve tÃ¼m commitâ€™leri deÄŸiÅŸtirebilmesi iÃ§in blob korumasÄ±nÄ± kapatÄ±yoruz. Burada yapÄ±lan iÅŸlemlerin listesi gÃ¶rÃ¼nÃ¼yor. Bu bilgi, ekip arkadaÅŸlarÄ±nÄ±zla paylaÅŸmak iÃ§in Ã¶nemlidir. En altta ise, bazÄ± garbage collection iÅŸlemlerini yapan ve ref logâ€™u gÃ¼ncelleyen bir komut veriliyor. Åimdi dosyanÄ±n artÄ±k orada olmadÄ±ÄŸÄ±nÄ± doÄŸrulayacaÄŸÄ±z â€” harika, tÃ¼m commitâ€™lerden silinmiÅŸ durumda. Promptâ€™umun repomun temiz olmadÄ±ÄŸÄ±nÄ± sÃ¶ylediÄŸini fark ettim. Bir bakalÄ±m, mantÄ±klÄ±: env dosyasÄ± artÄ±k commitâ€™li deÄŸil. Son olarak yapmanÄ±z gereken, gÃ¼ncellenmiÅŸ geÃ§miÅŸinizi force push ile gÃ¶ndermek olacaktÄ±r.

Laravel bir konfigÃ¼rasyon yardÄ±mcÄ± fonksiyonu ve sistemiyle birlikte gelir ve environment variableâ€™larÄ±mÄ±zÄ± bununla birleÅŸtirmek isteriz. Ã–rneÄŸin, belirli environment variableâ€™larÄ±mÄ±z olabilir; burada app name kullanÄ±yorum, bu genelde her ortamda aynÄ± olur. Fakat staging ortamÄ±nda olduÄŸunuzu kullanÄ±cÄ±lara gÃ¶stermek iÃ§in app nameâ€™e testing gibi bir deÄŸer verebilirsiniz. Bu app name deÄŸerini env dosyasÄ±na koyuyoruz. config/app.php dosyasÄ±nda ise Laravelâ€™in env helperâ€™Ä± ile bu deÄŸer okunur ve app name konfigÃ¼rasyon anahtarÄ±na aktarÄ±lÄ±r. Yani environment variableâ€™Ä± kullanÄ±rsak bunu konfigÃ¼rasyon sistemine taÅŸÄ±yoruz ve config ile bu bilgiyi Ã¶rneÄŸin bir blade dosyasÄ±na yazÄ±yoruz.

Burada Ã¶nemli olan, environment variableâ€™larÄ± doÄŸrudan almak yerine Laravelâ€™in config sistemini kullanmaktÄ±r. Bir Ã¶nceki slaytta gÃ¶rdÃ¼ÄŸÃ¼mÃ¼z gibi environment variable alÄ±rken varsayÄ±lan veya fallback deÄŸerleri kullanabilirsiniz. Ancak config deÄŸerleri her zaman tanÄ±mlÄ±dÄ±r, bu da elinizde nelerin mevcut olduÄŸunu anlamanÄ±za yardÄ±mcÄ± olur. Kendi config dosyanÄ±zÄ± da oluÅŸturabilirsiniz. Bu gerÃ§ekten iyi bir fikir olabilir Ã§Ã¼nkÃ¼ Laravel yÃ¼kseltmeleri bazÄ± varsayÄ±lan config dosyalarÄ±nda deÄŸiÅŸiklik yapabilir ve Laravel Shift gibi araÃ§lar bu durumda otomatik gÃ¼ncelleme yapamayabilir. Bu Ã¶rnekte bazÄ± anahtarlarÄ±m var: key path ve signing phrase. key path her ortam iÃ§in benzersiz, key passphrase ise gÃ¼venli bir ÅŸifre. BunlarÄ± env dosyasÄ±na koyuyorum. config/keys.php dosyasÄ±nda keypath environmentâ€™tan okunuyor, key passphrase de yine environmentâ€™tan alÄ±nÄ±yor. ArtÄ±k kodumuzda config('keys.keypath') ve config('keys.key_passphrase') gibi seÃ§eneklerle bu secretsâ€™leri ve benzersiz yapÄ±landÄ±rmalarÄ± kullanabiliriz.

GeliÅŸtirme veya deploy ortamÄ± iÃ§in doÄŸru environmentâ€™Ä± ayarlamak Ã¶nemlidir. env dosyasÄ±nda app env adÄ±nda bir deÄŸiÅŸken vardÄ±r ve varsayÄ±lan olarak localâ€™e ayarlanmÄ±ÅŸtÄ±r. Bu lokal geliÅŸtirme ortamÄ±nÄ± ifade eder. Ancak production, testing, staging gibi baÅŸka deÄŸerler de verilebilir; aslÄ±nda istediÄŸiniz herhangi baÅŸka bir deÄŸeri tanÄ±mlayabilirsiniz. Fakat app facadeâ€™da referans edilen bazÄ± yerleÅŸik deÄŸerler de bulunmaktadÄ±r. Bu durumda env deÄŸiÅŸkeni sadece yapÄ±landÄ±rÄ±lmÄ±ÅŸ app env deÄŸeridir. isLocal fonksiyonu, bunun local ya da production olup olmadÄ±ÄŸÄ±nÄ± belirtir. runningUnitTests metodu ise ortamÄ±n testing olarak ayarlanÄ±p ayarlanmadÄ±ÄŸÄ±nÄ± kontrol eder.

Laravelâ€™de testing deÄŸeri unit tests anlamÄ±na gelir; staging ile aynÄ± ÅŸey deÄŸildir. Kodunuzda runningUnitTestsâ€™e gÃ¶re koÅŸullar yazabilir ve farklÄ± davranÄ±ÅŸlar uygulayabilirsiniz. Laravelâ€™in kendisi de bunu kullanÄ±r. Ã–rneÄŸin verify CSRF token handle metodunda Ã§eÅŸitli koÅŸullar kontrol edilir ve bunlardan biri running unit testsâ€™dir. Bu middleware unit tests sÄ±rasÄ±nda sadece geÃ§er. Yani app env deÄŸiÅŸkeninin Laravel baÄŸlamÄ±nda bir anlamÄ± vardÄ±r; sadece hoÅŸ bir ek deÄŸildir.

AyrÄ±ca app debug adÄ±nda bir deÄŸiÅŸken vardÄ±r ve burada local ortamÄ±m olduÄŸu iÃ§in true. Bu, debug bilgilerini gÃ¶sterip gÃ¶stermeyeceÄŸimizi veya debug baÄŸlamÄ±nda Ã¶zel iÅŸlemler yapÄ±p yapmayacaÄŸÄ±mÄ±zÄ± belirlemek iÃ§in kullanÄ±lÄ±r. Ã–rneÄŸin, app debug deÄŸiÅŸkenine gÃ¶re daha fazla loglama yapmayÄ± seÃ§ebilirsiniz. Laravelâ€™in exception handlerâ€™Ä± da app debug deÄŸerine gÃ¶re yanÄ±tÄ± nasÄ±l iÅŸleyeceÄŸini belirler. Bu, ekranda whoops veya Symphony hata mesajÄ± gibi tÃ¼m yapÄ±landÄ±rmanÄ±zÄ±n detaylÄ± olarak gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ bir sayfa gÃ¶rmeniz (app debug true ise) ile kullanÄ±cÄ±ya bilgi sÄ±zdÄ±rmayan sade bir 500 ekranÄ± gÃ¶rmeniz arasÄ±ndaki farkÄ± belirler.

Bu nedenle bu deÄŸiÅŸkeni doÄŸru ÅŸekilde ayarlamak gerÃ§ekten Ã§ok Ã¶nemlidir.
