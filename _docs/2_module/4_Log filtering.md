# ğŸ—‚ï¸ Log Filtreleme

Laravelâ€™da log filtrelemeden biraz bahsedelim. AmacÄ±mÄ±z, loglarÄ±mÄ±zda hiÃ§bir hassas bilgi ya da secrets bulunmamasÄ±nÄ± saÄŸlamak. Laravelâ€™in logging sistemi kutudan Ã§Ä±ktÄ±ÄŸÄ± hÃ¢liyle oldukÃ§a gÃ¼Ã§lÃ¼dÃ¼r. BirÃ§ok driver ve stack yapÄ±landÄ±rmasÄ± vardÄ±r. Ã–rneÄŸin single, daily, slack ve syslog driverâ€™larÄ± dahili olarak gelir. Projenizde daha fazlasÄ± olabilir ve Ã¼Ã§Ã¼ncÃ¼ taraf plug-inâ€™ler bunlarÄ± geniÅŸletebilir. UygulamanÄ±zÄ±n hangi kanalÄ± kullandÄ±ÄŸÄ±nÄ± env dosyanÄ±zdan bulabilirsiniz, tÃ¼m kanallar config/logging.php dosyasÄ±nda tanÄ±mlÄ±dÄ±r. GÃ¼zel bir nokta da loglarÄ±n varsayÄ±lan olarak Ã¶zel bir storage dizininde bulunmasÄ± ve kamuya aÃ§Ä±k olmamasÄ±dÄ±r.

Bu genellikle modern PHP uygulamalarÄ±nda sorun deÄŸildir, ancak eski uygulamalarda veya shared hostâ€™larda bazen loglar halka aÃ§Ä±k dizinlerde olabilir. Peki Laravelâ€™de loglarÄ± ne Ã¼retir? Ä°lk olarak, herhangi biri log global metodunu veya log facadeâ€™Ä±nÄ± kullanarak log oluÅŸturabilir. Bu debug veya warning gibi loglar Ã¼retmek iÃ§in kolay bir yoldur. AyrÄ±ca exception handlerâ€™Ä±n varsayÄ±lan yapÄ±landÄ±rmasÄ± da log oluÅŸturur. Bunlar stack traceâ€™ler, context ve diÄŸer deÄŸiÅŸkenleri iÃ§erebilir.

Peki loglarÄ± neden filtrelemekle uÄŸraÅŸÄ±yoruz? Secrets tekrarÄ±nÄ± minimumda tutmak iÃ§in bu iyi bir kuraldÄ±r. Secretsâ€™lerin mÃ¼mkÃ¼n olduÄŸunca az yerde bulunmasÄ±nÄ± isteriz ve kaybolabilecekleri farklÄ± yerlere yayÄ±lmalarÄ±nÄ± istemeyiz. AyrÄ±ca sunucu yapÄ±landÄ±rmanÄ±za veya Laravel logging yapÄ±landÄ±rmanÄ±za baÄŸlÄ± olarak loglar Ã¼Ã§Ã¼ncÃ¼ taraflara gÃ¶nderilebilir. Bu Ã¼Ã§Ã¼ncÃ¼ taraflara loglarÄ±mÄ±zÄ± emanet ediyoruz, ancak yine de tÃ¼m secretsâ€™leri onlarla paylaÅŸmak zorunda deÄŸiliz.

Åimdi exceptions durumunda loglara hangi secretsâ€™lerin sÄ±zabileceÄŸine bakalÄ±m. Hata Ã¼reten bir artisan komutu Ã§alÄ±ÅŸtÄ±racaÄŸÄ±m ve exception fÄ±rlatacaÄŸÄ±z. Ekranda bir database hatasÄ± gÃ¶rÃ¼yorsunuz. Åimdi exception handlerâ€™Ä±n logladÄ±ÄŸÄ± ÅŸeye bakalÄ±m. OldukÃ§a fazla bilgi var. Ä°lk bakÄ±ÅŸta ciddi bir sorun yok gibi. Biraz kaydÄ±ralÄ±m. Ä°ÅŸte burada! SÃ¼per gizli parolam. Hem de birkaÃ§ kez tekrar edilmiÅŸ. Bunun loglarda olmasÄ±nÄ± kesinlikle istemiyorum.

Peki loglardan bu secretsâ€™leri nasÄ±l filtreleriz? Laravel, monolog instanceâ€™Ä±na eriÅŸmemize izin verir. Buradan loglayÄ±cÄ±larÄ± veya formatlayÄ±cÄ±larÄ± deÄŸiÅŸtirebiliriz. Var olan bir sÃ¼reci ve formatlayÄ±cÄ±yÄ± kullanÄ±p Ã§Ä±ktÄ± log writerâ€™a gÃ¶nderilmeden Ã¶nce filtreleyebiliriz. Hadi buna bakalÄ±m.

Burada config/logging.php dosyasÄ±na bakÄ±yoruz. Stack ve single kanallarÄ± varsayÄ±lan olarak yapÄ±landÄ±rÄ±lmÄ±ÅŸ. Ben filtered adÄ±nda bir kanal ekleyeceÄŸim. GÃ¶rdÃ¼ÄŸÃ¼nÃ¼z gibi single kanalÄ±nÄ±n bir kopyasÄ± gibi, ancak tap Ã¶zniteliÄŸini ekliyorum. Bu, monolog instanceâ€™Ä±na bazÄ± iÅŸlemler eklememi saÄŸlar. KullanacaÄŸÄ±m sÄ±nÄ±f customized formatter olacak. ArdÄ±ndan env dosyamda log channel olarak filtered kanalÄ±nÄ± iÅŸaretliyorum.

AsÄ±l sihrin gerÃ§ekleÅŸtiÄŸi yer ise customized formatter sÄ±nÄ±fÄ±. Laravel, monolog instanceâ€™Ä±nÄ± invoked metoduna geÃ§iriyor. Burada her handlerâ€™Ä± dÃ¶ngÃ¼yle dolaÅŸÄ±p kendi formatterâ€™Ä±mÄ± ayarlÄ±yorum. Laravelâ€™in varsayÄ±lan yapÄ±landÄ±rmasÄ±yla her ÅŸeyin aynÄ± ÅŸekilde Ã§alÄ±ÅŸmasÄ±nÄ± istediÄŸim iÃ§in frameworkâ€™ten line format instance oluÅŸturan kodu kopyaladÄ±m. Tek fark, artÄ±k filtered line formatter adlÄ± bir sÄ±nÄ±f kullanÄ±yor olmam. Bu sÄ±nÄ±f aynÄ± dizinde bulunuyor.

filtered line formatter ise normal line formatterâ€™Ä± geniÅŸletiyor. BÃ¶ylece format metodunun parentâ€™Ä± Ã§aÄŸÄ±rÄ±p tÃ¼m normal formatlamayÄ± yapmasÄ±nÄ± saÄŸlÄ±yorum. Ben formatlamaya dokunmak istemiyorum, sadece sonrasÄ±nda protected iÃ§erikleri deÄŸiÅŸtiriyorum ve stringâ€™i geri dÃ¶ndÃ¼rÃ¼yorum. Bu Ã¶rnekte, secrets tuttuÄŸuna inandÄ±ÄŸÄ±m config anahtarlarÄ±nÄ± belirledim ve bunlarÄ±n deÄŸerlerini â€œfilteredâ€ ile deÄŸiÅŸtirdim.

BakÄ±n ÅŸimdi exception fÄ±rlattÄ±ÄŸÄ±mda ne oluyor. AynÄ± artisan komutunu Ã§alÄ±ÅŸtÄ±rÄ±yorum, yeni logging yapÄ±landÄ±rmam aktif. Loglara bakalÄ±m. Ä°lk bakÄ±ÅŸta aynÄ± gÃ¶rÃ¼nÃ¼yor. Ama yukarÄ± kaydÄ±rÄ±nca, iÅŸte! Secret parola tÃ¼m geÃ§tiÄŸi yerlerde filtrelenmiÅŸ. Harika.

Bu sadece tek bir Ã¶rnekti. KonfigÃ¼re edilmiÅŸ deÄŸerlere gÃ¶re filtreleyebiliriz. Belirli stringâ€™leri bulup filtreleyebiliriz. Exceptions iÃ§inde gelen context veya extra verilerini de filtreleyebiliriz. KÄ±sacasÄ±, monolog instanceâ€™Ä±na eriÅŸebilir ve tÃ¼m secrets veya hassas bilgileri loglardan temizleyebilirsiniz. Bu da yapÄ±lmasÄ± gereken harika bir ÅŸeydir.
