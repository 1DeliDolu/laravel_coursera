

# ğŸ›¡ï¸ Yetkilendirme Ã–nerileri

Bu dersi, Laravelâ€™de yetkilendirmeyi kullanÄ±rken ve uygularken dikkat edebileceÄŸin bazÄ± ipuÃ§larÄ± ve en etkili en iyi uygulamalarla tamamlayacaÄŸÄ±m. Ä°lk Ã¶nerim, authentication iÃ§in verdiÄŸime Ã§ok benziyor: Gate ve Policyâ€™leri mÃ¼mkÃ¼n olduÄŸunca dÄ±ÅŸ katmana, yani isteÄŸin hayat dÃ¶ngÃ¼sÃ¼nÃ¼n en dÄ±ÅŸÄ±na konumlandÄ±r. Spesifik bir Policy uygulayamadÄ±ÄŸÄ±n durumlarda veya tekil invocable controllerâ€™larla Ã§alÄ±ÅŸÄ±yorsan permission kontrolÃ¼ iÃ§in middleware kullan. Aksi halde, controllerâ€™larÄ±nÄ±n constructorâ€™larÄ±nda authorized resource metodunu kullan. Bu, bir allow list oluÅŸturur; yani ihtiyaÃ§larÄ±nÄ± birebir tanÄ±mlamadÄ±ÄŸÄ±n sÃ¼rece her ÅŸeyi yetkisiz kÄ±lar veya bir hata Ã¼retir.

En sonunda form request iÃ§inde authorization yapabilirsin. Burada adÄ±m adÄ±m her seferinde gerÃ§ek koda yaklaÅŸÄ±yoruz. Form requestâ€™lerden birazdan bahsedeceÄŸim. Son olarak Blade metodlarÄ±nÄ± eriÅŸim kontrolÃ¼ iÃ§in deÄŸil, sadece kullanÄ±cÄ± deneyimi iÃ§in kullan. Veriyi viewâ€™a gÃ¶nderip orayÄ± son savunma hattÄ± yapmak yerine daha dÄ±ÅŸ katmanda authorization uygulayarak veri filtrelemek Ã§ok daha iyidir.

Form requestâ€™lerde authorize metodunu kullanarak yetkilendirme kontrolÃ¼ yapabilirsin. Burada test edebileceÄŸin basit bir Ã¶rnek var. Diyelim ki view-pet isimli Ã§ok Ã¶zel bir policy metodu var. Bunu view-pet isimli form request iÃ§inde kontrol edebilirsin. Form requestâ€™lerin isimlerine raÄŸmen yalnÄ±zca form gÃ¶nderimleri iÃ§in kullanÄ±lmak zorunda olmadÄ±ÄŸÄ±nÄ± unutma. Sadece iÃ§erik gÃ¶steren normal metotlar iÃ§in de kullanÄ±labilirler. EÄŸer karmaÅŸÄ±k bir yetkilendirme mekanizman varsa authorize metodunda bunu tanÄ±mlayabilirsin.

Bu Ã¶zellikle gelen veriye gÃ¶re permission sisteminin deÄŸiÅŸtiÄŸi durumlarda Ã§ok iÅŸe yarar. Authorize metodu iÃ§indeyken gelen parametrelere eriÅŸimin vardÄ±r. Ã–rnekte pet parametresini alÄ±yorum, ama gÃ¶nderilen (post edilen) bilgilere de eriÅŸebilirsin. Unutma, bunlar henÃ¼z doÄŸrulanmadÄ± veya filtrelenmedi. Yine de alabilir ve authorization adÄ±mlarÄ±nÄ±n bir parÃ§asÄ± olarak kullanabilirsin.

Ã–rneÄŸin, kullanÄ±cÄ±larÄ±n kuyruklarÄ±na en fazla beÅŸ film eklemesine izin veren bir policy olduÄŸunu varsayalÄ±m. Daha fazlasÄ±nÄ± eklemek iÃ§in pro hesap gerekir. Authorize metodunda bu senaryoyu kontrol edebilirsin. Mevcut kullanÄ±cÄ±yÄ± alÄ±rsÄ±n, kuyruktaki film sayÄ±sÄ±nÄ± (Ã¶rneÄŸin 4) Ã¶ÄŸrenirsin. ArdÄ±ndan kullanÄ±cÄ±nÄ±n hesabÄ±nÄ± dÃ¼zenlediÄŸini kontrol edersin; sadece dÃ¼zenliyorsa sorun yok, edit queue policy Ã§alÄ±ÅŸÄ±r. Ama iki tane daha ekliyorsa? Bu durumda edit queue policyâ€™yi kontrol ettikten sonra baÄŸlam olarak dÃ¶rt video + iki ek video bilgisini geÃ§erek add to queue policyâ€™yi de kontrol edersin. Policy bu toplamÄ± hesaplar ve pro abonelik gerekip gerekmediÄŸine karar verir.

Takip etmesi zor olabilir, ama Ã¶rneÄŸin kendisinden Ã§ok form request iÃ§inde daha karmaÅŸÄ±k authorization yapÄ±labileceÄŸini gÃ¶stermek iÃ§in anlattÄ±m. Bununla birlikte, karmaÅŸÄ±k olmayan mekanizmalar iÃ§in authorizationâ€™Ä± isteÄŸin daha dÄ±ÅŸ katmanlarÄ±nda uygulamalÄ±sÄ±n. KÄ±sacasÄ±, teknolojileri ve araÃ§larÄ± doÄŸru ÅŸekilde harmanlamalÄ±yÄ±z.

Bir Policy oluÅŸtururken ÅŸuna dikkat ederim: Bu kullanÄ±cÄ±nÄ±n rolÃ¼ bu eylemi yapma yetkisine sahip mi? EÄŸer sahip ise aynÄ± zamanda bu spesifik nesne Ã¼zerinde bu iÅŸlemi yapabilir mi? Ã–rneÄŸin bir envanter Ã¶ÄŸesini gÃ¼ncellerken Ã¶nce kullanÄ±cÄ±nÄ±n inventory yÃ¶netme izni olup olmadÄ±ÄŸÄ±na bakarÄ±m. Varsa bu envanter Ã¶ÄŸesinin aynÄ± maÄŸazaya ait olup olmadÄ±ÄŸÄ±na bakarÄ±m. Bu iyi bir policy kontrolÃ¼dÃ¼r. Ama aynÄ± zamanda kullanÄ±cÄ±nÄ±n inventory itemâ€™larÄ±nÄ± dÃ¼zenleme izni olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek isterim; Ã§Ã¼nkÃ¼ maÄŸazada Ã§alÄ±ÅŸan bir personel olabilirimâ€”Ã¶ÄŸeleri gÃ¶rebilirim ama dÃ¼zenleme iznim yoktur. Bu rolÃ¼ yasaklamak iÃ§in Spatie permission paketini kullanÄ±rÄ±m.

Son olarak oldukÃ§a itiraz aldÄ±ÄŸÄ±m bir tavsiyem var: Yetkilendirme tanÄ±mlarÄ±nÄ± sadece kodda yap. Spatie roles ve permissions gibi paketler izinleri ve kalÄ±tÄ±mÄ± veritabanÄ±nda yÃ¶netir. Bu gÃ¼zel. Ama bu, anlÄ±k olarak izinleri dÃ¼zenlemek iÃ§in bir admin arayÃ¼zÃ¼ oluÅŸturman gerektiÄŸi anlamÄ±na gelmez. BirÃ§ok kiÅŸi â€œesneklik lazÄ±mâ€ diyor. Ben de diyorum ki: Gerekmez. EÄŸer yetkilendirmeni bu kadar sÄ±k deÄŸiÅŸtirmen gerekiyorsa belki de deployment sÃ¼reÃ§lerine odaklanarak bu gÃ¼ncellemeleri kodda daha hÄ±zlÄ± uygulamayÄ± dÃ¼ÅŸÃ¼nmelisin.

Yetkilendirmemin sadece kodda tanÄ±mlÄ± olmasÄ±nÄ± isterim. VeritabanÄ±yla Ã§alÄ±ÅŸsam bile dÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ veya seed kodu yazarak bu girdileri eklerim. Neden? Birincisi, gÃ¶rÃ¼nÃ¼rlÃ¼k. Koda eriÅŸimim olduÄŸunda yetkilendirme modelini tÃ¼mÃ¼yle anlamak isterim. Kontrolleri gÃ¶rmek bunun sadece yarÄ±sÄ±dÄ±r. Bir gÃ¼venlik modeli Ã¼zerinde Ã§alÄ±ÅŸÄ±rken tÃ¼m resmi bilmelisin â€” sadece kontrolleri deÄŸil, yetkilendirmenin tanÄ±mÄ±nÄ± da. Programlama Ã§oÄŸu zaman cebirseldir ve soyut olabilir, ancak gÃ¼venlik bence Ã¶yle olmamalÄ±.

Ä°kincisi, izlenebilirlik. Evet, veritabanÄ±nda bir denetim sistemi kurabilirsin ama genelde zahmetlidir veya unutulur. ÃœÃ§ ay Ã¶nce bir kullanÄ±cÄ±nÄ±n nasÄ±l bir iÅŸlem yaptÄ±ÄŸÄ±nÄ± araÅŸtÄ±rÄ±rken iÅŸ modelinin deÄŸiÅŸip deÄŸiÅŸmediÄŸini veya koddaki bir bugâ€™Ä±n buna sebep olup olmadÄ±ÄŸÄ±nÄ± nasÄ±l kolayca anlayacaksÄ±n? Koddaysa, o tarihteki koda dÃ¶nÃ¼p yetkilendirme modelinin ne olduÄŸunu gÃ¶rebilirsin. VeritabanÄ± tabanlÄ± bir sistemde ise ancak audit kayÄ±tlarÄ±nÄ± birleÅŸtirerek bir sonuca varmaya Ã§alÄ±ÅŸÄ±rsÄ±nâ€”muhtemelen tahmin ederek.

Son olarak, test edilebilirlik. Yetkilendirme kÃ¼tÃ¼phanesi yapanlar elbette soyut yapÄ±larÄ± test ediyor, ama onlar sadece kendi kÃ¼tÃ¼phanesini dÃ¼ÅŸÃ¼nÃ¼yor. Bizim devasa ve dinamik bir uygulamamÄ±z var ve tÃ¼m yetkilendirme Ã§aÄŸrÄ±larÄ±nÄ± ve tÃ¼m konfigurasyonlarÄ± test etmek mÃ¼mkÃ¼n deÄŸildir. Buna karÅŸÄ±lÄ±k, yetkilendirmen kodda yapÄ±landÄ±rÄ±lmÄ±ÅŸsa belirli yetkilendirme uygulamalarÄ± iÃ§in kolayca unit test yazabilirsin. Testlerin ne kadar basit, doÄŸru ve saÄŸlam olursa uygulamanÄ±n o kadar gÃ¼venli olma ihtimali artar.

Bu kursun yetkilendirme kÄ±smÄ± bÃ¶ylece tamamlanÄ±yor. Unutma: Authentication â€œkimâ€, authorization â€œne yapabilirâ€. Yetkilendirmeyi isteÄŸin hayat dÃ¶ngÃ¼sÃ¼nde mÃ¼mkÃ¼n olduÄŸunca dÄ±ÅŸta konumlandÄ±r. Uygulaman iÃ§in doÄŸru yetkilendirme seviyesini kullan â€” bu Ã§oÄŸunlukla Policyâ€™lerdir ve gerekirse role & permission sistemiyle gÃ¼Ã§lendirilebilir. Son olarak, kod iÃ§inde takip edilebilir bir allow list tabanlÄ± yetkilendirme sistemi oluÅŸtur.
